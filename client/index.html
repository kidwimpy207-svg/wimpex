<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0a0e27">
  <meta name="description" content="Wimpex - Gold-themed Snapchat-like social media app">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect fill='%230a0e27' width='180' height='180'/><text x='90' y='120' font-size='80' font-weight='900' text-anchor='middle' fill='%23d4af37'>âœ¨</text></svg>">
  <title>Wimpex - Gold Stories</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="chat_component.css">
</head>
<body>
  <a class="skip-link" href="#main" style="position:absolute;left:-999px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to content</a>
  <button id="installBtn" style="display:none;position:fixed;right:16px;bottom:16px;padding:10px 14px;border-radius:12px;background:#d4af37;color:#0a0e27;border:none;z-index:10000;box-shadow:0 6px 18px rgba(0,0,0,0.35);">Install App</button>
  <!-- Auth Modals -->
  <div id="authContainer" class="auth-container" style="display:block;">
    <div class="auth-card">
      <div class="auth-header">âœ¨ Wimpex</div>
      <div id="authTabs" class="auth-tabs">
        <button class="tab-btn active" data-tab="login">Login</button>
        <button class="tab-btn" data-tab="signup">Sign Up</button>
      </div>

      <!-- Login Form -->
      <form id="loginForm" class="auth-form active">
        <div class="login-options">
          <label><input type="radio" name="loginType" value="email" checked> Email</label>
          <label><input type="radio" name="loginType" value="phone"> Phone</label>
          <label><input type="radio" name="loginType" value="username"> Username</label>
        </div>
        <input id="loginInput" type="text" placeholder="Email / Phone / Username" required>
        <input id="loginPassword" type="password" placeholder="Password" required>
        <button id="loginBtn" type="button" class="gold-btn">Login</button>
        <div style="margin-top:8px;text-align:right;"><a id="forgotLink" href="#" style="color:var(--gold);font-weight:600;">Forgot password?</a></div>
      </form>

      <!-- Signup Form -->
      <form id="signupForm" class="auth-form hidden">
        <input id="signupUsername" type="text" placeholder="Username" maxlength="20" required>
        <input id="signupPhone" type="tel" placeholder="Phone Number (+1-555-0000)" maxlength="15">
        <input id="signupEmail" type="email" placeholder="Email" required>
        
        <!-- Gender Selection -->
        <div class="gender-select">
          <label>Gender</label>
          <div class="gender-options">
            <label class="gender-option">
              <input type="radio" name="gender" value="male" required>
              <span>â™‚ï¸ Male</span>
            </label>
            <label class="gender-option">
              <input type="radio" name="gender" value="female" required>
              <span>â™€ï¸ Female</span>
            </label>
            <label class="gender-option">
              <input type="radio" name="gender" value="other" required>
              <span>âœ¨ Other</span>
            </label>
          </div>
        </div>

        <input id="signupPassword" type="password" placeholder="Password (min 6 chars)" minlength="6" required>
        <input id="signupConfirm" type="password" placeholder="Confirm Password" required>
        <button id="signupBtn" type="button" class="gold-btn">Create Account</button>
      </form>

      <div id="authError" class="auth-error hidden"></div>
      <!-- Forgot Password Modal -->
      <div id="forgotModal" class="modal hidden">
        <div class="modal-content">
          <h2>Reset Password</h2>
          <p>Enter your email and we'll send a reset link.</p>
          <input id="forgotEmail" type="email" placeholder="Your email">
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="sendForgotBtn" class="gold-btn">Send Reset Link</button>
            <button id="cancelForgotBtn" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);">Cancel</button>
          </div>
          <div id="forgotStatus" style="margin-top:12px;color:var(--text-secondary);"></div>
        </div>
      </div>
      <!-- Email Verification Modal -->
      <div id="verifyModal" class="modal hidden">
        <div class="modal-content">
          <h2>Verify Your Email</h2>
          <p>We've sent a verification link to your email. Paste the token below or click resend.</p>
          <input id="verifyTokenInput" type="text" placeholder="Paste verification token">
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="verifyTokenBtn" class="gold-btn">Verify</button>
            <button id="resendVerifyBtn" class="gold-btn">Resend Email</button>
            <button id="closeVerifyBtn" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);">Close</button>
          </div>
          <div id="verifyStatus" style="margin-top:12px;color:var(--text-secondary);"></div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // Safety: prevent native form submits to avoid full page refresh if app.js fails.
    (function(){
      try{
        ['loginForm','signupForm'].forEach(id => {
          const f = document.getElementById(id);
          if (!f) return;
          f.addEventListener('submit', function(e){ e.preventDefault(); console.warn('[safety] blocked native submit for', id); });
        });
        // Bind click fallback to buttons to trigger requestSubmit so app-level handlers still run
        const lb = document.getElementById('loginBtn'); if (lb) lb.addEventListener('click', ()=>{ const f=document.getElementById('loginForm'); if (f && typeof f.requestSubmit==='function') f.requestSubmit(); else f && f.dispatchEvent(new Event('submit',{bubbles:true,cancelable:true})); });
        const sb = document.getElementById('signupBtn'); if (sb) sb.addEventListener('click', ()=>{ const f=document.getElementById('signupForm'); if (f && typeof f.requestSubmit==='function') f.requestSubmit(); else f && f.dispatchEvent(new Event('submit',{bubbles:true,cancelable:true})); });
      }catch(e){ console.error('Form safety init failed', e); }
    })();
  </script>

  <!-- Sidebar Navigation -->
  <nav class="sidebar hidden">
    <div class="sidebar-logo">âœ¨</div>
    <button id="storiesBtn" class="nav-btn" title="Stories">ğŸ“–</button>
    <button id="chatsBtn" class="nav-btn active" title="Messages">ğŸ’¬</button>
    <button id="callsBtn" class="nav-btn" title="Calls">ğŸ“</button>
    <button id="recommendationsBtn" class="nav-btn" title="People">ğŸ‘¥</button>
    <button id="wimpyBtn" class="nav-btn" title="Wimpy">ğŸ¤–</button>
    <button id="cameraBtn" class="nav-btn" title="Create">ğŸ“¸</button>
    <button id="profileBtn" class="nav-btn" title="Profile">ğŸ‘¤</button>
    <button id="settingsBtn" class="nav-btn" title="Settings">âš™ï¸</button>
    <div class="sidebar-spacer"></div>
  </nav>

  <!-- Main Container -->
  <div class="main-container">
    <!-- Stories View -->
    <div id="storiesView" class="view hidden">
      <div class="stories-header">
        <h2>Stories</h2>
        <button id="newStoryBtn" class="gold-btn">+ New Story</button>
      </div>
      <div id="storiesGrid" class="stories-grid"></div>
    </div>

    <!-- Chat View (default) -->
    <div id="chatsView" class="view">
      <div class="chats-container">
        <div class="chats-list-section">
          <div class="chats-header">
            <h2>Messages</h2>
            <button id="newChatBtn" class="gold-btn">+ New Chat</button>
          </div>
          <div id="chatsList" class="chats-list"></div>
        </div>
        <div id="chatDetail" class="chat-detail hidden">
          <div class="chat-header">
            <button id="backToChats" class="back-btn">â† Back</button>
            <img id="chatHeaderAvatar" class="chat-header-avatar" src="" alt="" style="cursor:pointer;transition:all 0.3s;display:none;">
            <div class="chat-info">
              <h3 id="chatName" style="cursor:pointer;transition:all 0.3s;" title="Click to view profile"></h3>
              <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                <span id="chatStatus" class="status-indicator"></span>
                <span id="chatLastStatus" class="chat-last-status" style="font-size:12px;color:var(--muted);margin-left:6px;">&nbsp;</span>
                <div style="display:flex;align-items:center;gap:4px;background:rgba(212,175,55,0.12);padding:4px 8px;border-radius:8px;">
                  <span id="chatStreak" style="font-size:16px;font-weight:600;color:#ff8c00;">ğŸ”¥ 0</span>
                  <span id="chatFlameHealth" style="font-size:11px;color:#ff8c00;letter-spacing:1px;">â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘</span>
                </div>
              </div>
            </div>
            <button id="chatMenuBtn" class="chat-menu-btn">â‹®</button>
            <button id="pinScrollBtn" class="chat-menu-btn" title="Pin to bottom" aria-pressed="false">ğŸ“Œ</button>
            <div id="chatMenu" class="chat-menu hidden">
              <div class="chat-menu-item">ğŸ“¹ Start Video Call</div>
              <div class="chat-menu-item">â˜ï¸ Start Audio Call</div>
              <div class="chat-menu-separator" style="height:1px;background:rgba(212,175,55,0.2);margin:8px 0;"></div>
              <div class="chat-menu-item">ğŸ‘¥ Create Group</div>
              <div class="chat-menu-item">ğŸ” Search User</div>
              <div class="chat-menu-item">ğŸŒ™ Toggle Theme</div>
              <div class="chat-menu-item">ğŸ—‘ï¸ Clear Chat</div>
              <div class="chat-menu-item">ğŸ”‡ Mute Chat</div>
            </div>
          </div>
          <div id="messagesLog" class="messages-log"></div>
          <div id="newMessageIndicator" class="new-message-indicator hidden" role="button" tabindex="0" aria-hidden="true">
            <span id="newMessageCount" class="new-message-count">0</span>
            <span class="new-message-text">New messages â€¢ Jump to bottom</span>
          </div>
          <form id="messageForm" class="message-input">
            <textarea id="messageInput" placeholder="Type a message..." autocomplete="off" style="resize:none;"></textarea>
            <button type="button" id="msgCameraBtn" class="msg-action-btn" title="Send image, video, or file">ğŸ“·</button>
            <button type="button" id="voiceBtn" class="msg-action-btn voice-btn" title="Hold to record voice">ğŸ™ï¸</button>
            <button type="submit" class="send-btn">â¤</button>
            <input id="chatMediaInput" type="file" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt" style="display:none;">
          </form>

          <!-- Recording indicator (shown while recording) -->
          <div id="recordingIndicator" class="recording-indicator hidden" aria-hidden="true">
            <div class="recording-dot" aria-hidden="true"></div>
            <div class="waveform" aria-hidden="true">
              <div class="wave"></div>
              <div class="wave"></div>
              <div class="wave"></div>
              <div class="wave"></div>
            </div>
            <span id="recordingTime">0:00</span>
          </div>

          <!-- Streak restore modal trigger placed in menu -->
          <div id="streakRestoreModal" class="modal hidden">
            <div class="modal-content" style="max-width:420px; text-align:center;">
              <h2>ğŸ”¥ Streak Expired</h2>
              <p id="restoreInfo" style="color:#ff6b6b;margin-bottom:16px;">Your streak has expired. Would you like to restore it?</p>
              <div style="display:flex;gap:8px;justify-content:center;flex-direction:column;">
                <button id="useRestoreBtn" class="gold-btn">ğŸ’« Use Free Restore <span id="restoreCountText">(3 left)</span></button>
                <button id="buyRestoreBtn" class="gold-btn" style="background:rgba(212,175,55,0.1);border:2px solid var(--gold);color:var(--gold);">ğŸ’³ Buy Premium Restore</button>
              </div>
              <button class="close-modal-btn" style="margin-top:12px;">Close</button>
            </div>
          </div>


        </div>
      </div>
    </div>

    <!-- Recommendations View -->
    <div id="recommendationsView" class="view hidden">
      <div class="recommendations-container">
        <h2>ğŸ‘¥ People You May Know</h2>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
          <input id="peopleSearchInput" type="search" placeholder="Search by username..." style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);">
          <button id="peopleSearchBtn" class="gold-btn">Search</button>
        </div>
        <div id="recommendationsList" class="recommendations-grid"></div>
        <h3 style="margin-top:18px;margin-bottom:8px;">Pending Friend Requests</h3>
        <div id="pendingRequestsList" style="display:flex;flex-direction:column;gap:8px;max-height:220px;overflow:auto;padding:8px;border:1px solid rgba(255,255,255,0.03);border-radius:8px;background:rgba(255,255,255,0.01);"></div>
        <div id="noRecommendations" class="empty-state hidden">
          <p>ğŸ‰ You follow everyone! Check back later for new users.</p>
        </div>
      </div>
    </div>

    <!-- Calls History View -->
    <div id="callsView" class="view hidden">
      <div class="calls-container">
        <div class="calls-header" style="display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.03);">
          <h2>Call History</h2>
          <button id="refreshCallsBtn" class="gold-btn">Refresh</button>
        </div>
        <div id="callsList" style="padding:12px;display:flex;flex-direction:column;gap:10px;max-height:calc(100vh - 160px);overflow-y:auto;"></div>
        <div id="noCalls" class="empty-state hidden" style="padding:16px;text-align:center;color:#999;">No calls yet.</div>
      </div>
    </div>
    <!-- Wimpy Chat View -->
    <div id="wimpyView" class="view hidden">
      <div class="wimpy-container" style="padding:12px;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
          <h2>ğŸ¤– Wimpy</h2>
          <div style="display:flex;gap:8px;align-items:center;">
            <button id="wimpyRefreshBtn" class="gold-btn">Refresh</button>
            <button id="wimpyNewBtn" class="gold-btn">New Chat</button>
          </div>
        </div>
        <div style="display:flex;gap:12px;">
          <div style="width:280px;max-height:60vh;overflow:auto;border-right:1px solid rgba(255,255,255,0.03);padding-right:8px;" id="wimpyConversationsList">
            <p style="color:var(--muted);padding:8px;">Loading conversations...</p>
          </div>
          <div style="flex:1;display:flex;flex-direction:column;gap:8px;">
            <div id="wimpyMessagesLog" class="messages-log" style="max-height:60vh;overflow:auto;padding:12px;background:transparent;border-radius:8px;">Open a conversation or create a new chat.</div>
            <form id="wimpyForm" style="display:flex;gap:8px;align-items:center;">
              <input id="wimpyInput" type="text" placeholder="Ask Wimpy something..." style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text-primary);">
              <button type="button" id="wimpyAttachBtn" class="gold-btn" title="Attach media">ğŸ“</button>
              <input id="wimpyMediaInput" type="file" accept="image/*,video/*" style="display:none">
              <button type="submit" class="gold-btn">Send</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Avatar full-size modal -->
    <div id="avatarModal" class="modal hidden">
      <div class="modal-content" style="max-width:820px;text-align:center;">
        <img id="avatarModalImg" src="" alt="Avatar" style="max-width:100%;max-height:80vh;border-radius:8px;">
        <div style="margin-top:12px;"><button class="close-modal-btn">Close</button></div>
      </div>
    </div>

    <!-- Camera/Snap Creation -->
    <div id="cameraView" class="view hidden">
      <div class="camera-container">
        <video id="cameraStream" class="camera-feed" autoplay playsinline></video>
        <div class="filter-strip" role="toolbar" aria-label="Filters">
          <button class="filter-btn active" data-filter="none">Normal</button>
          <button class="filter-btn" data-filter="sepia">Sepia</button>
          <button class="filter-btn" data-filter="grayscale">B&W</button>
          <button class="filter-btn" data-filter="invert">Invert</button>
          <button class="filter-btn" data-filter="blur">Blur</button>
          <button class="filter-btn" data-filter="warm">Warm</button>
          <button class="filter-btn" data-filter="cool">Cool</button>
          <button class="filter-btn" data-filter="vivid">Vivid</button>
          <button class="filter-btn" data-filter="lomo">Lomo</button>
        </div>
        <div class="camera-controls">
          <button id="snapBtn" class="snap-btn">ğŸ“¸ Snap</button>
          <button id="recordBtn" class="record-btn">âº Record</button>
          <button id="swapCameraBtn" class="swap-btn">ğŸ”„</button>
          <button id="galleryBtn" class="snap-btn" title="Upload from gallery">ğŸ–¼ï¸ Gallery</button>
        </div>
        <input id="galleryInput" type="file" accept="image/*,video/*" style="display:none;">
        <canvas id="snapCanvas" style="display:none;"></canvas>
      </div>
      <div id="snapPreview" class="snap-preview hidden">
        <img id="snapImage" src="" alt="">
        <div class="snap-controls">
          <button id="resnapBtn" class="ctrl-btn">Retake</button>
          <input id="snapRecipient" type="text" placeholder="Send to username or 'story'">
          <textarea id="snapCaption" placeholder="Add a caption (optional)" style="width:100%;margin-top:8px;border-radius:8px;padding:8px;background:rgba(255,255,255,0.02);color:var(--text-primary);height:56px;resize:none;"></textarea>
          <div style="display:flex;gap:8px;align-items:center;margin-top:6px;">
            <button id="openMusicPickerBtn" type="button" class="gold-btn" style="padding:8px 12px;">ğŸµ Add Music</button>
            <div id="selectedMusicDisplay" style="color:var(--muted);font-size:13px;">No music selected</div>
            <input id="snapAudioInput" type="file" accept="audio/*" style="display:none;" />
            <button id="attachAudioBtn" type="button" class="gold-btn" style="padding:8px 12px;">ğŸ§ Attach Audio</button>
          </div>
          <button id="sendSnapBtn" class="send-btn gold-btn" style="margin-top:8px;">Send Snap</button>
          <input id="selectedMusic" type="hidden" value="" />
        </div>
      </div>
    </div>

    <!-- Profile View -->
    <div id="profileView" class="view hidden">
      <div class="profile-card">
        <img id="profileAvatar" class="avatar-large" src="" alt="">
        <h2 id="profileName"></h2>
        <p id="profileBio" class="bio">Snapchat enthusiast</p>
        <div class="profile-stats">
          <div class="stat"><strong id="friendCount">0</strong> Friends</div>
          <div class="stat"><strong id="storyCount">0</strong> Stories</div>
          <div class="stat"><strong id="profileWimpScore">0</strong> ğŸ†</div>
          <div class="stat"><strong id="profileStreakCount">0</strong> ğŸ”¥</div>
        </div>
        <button id="editProfileBtn" class="gold-btn">Edit Profile</button>
        <button id="addFriendsBtn" class="gold-btn">ğŸ‘¥ Add Friends</button>
        <button id="shareProfileBtn" class="gold-btn">ğŸ”— Share Profile</button>
        <button id="backToChatBtn" class="gold-btn" style="display:none;">â† Back to Chat</button>
      </div>
    </div>

    <!-- Settings View -->
    <div id="settingsView" class="view hidden">
      <div class="settings-container">
        <h2>âš™ï¸ Settings</h2>
        <!-- Theme Toggle -->
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;flex-wrap:wrap;">
          <span style="color:var(--text-secondary);font-size:13px;">Theme:</span>
          <button id="themeToggleBtn" class="theme-toggle" title="Toggle Theme" style="padding:8px 12px;background:rgba(212,175,55,0.1);border:2px solid var(--gold);border-radius:6px;color:var(--gold);cursor:pointer;font-weight:600;">ğŸŒ™ Dark Mode</button>
          <button id="themeCyberpunkBtn" class="theme-btn">Cyberpunk</button>
          <button id="themeNarutoBtn" class="theme-btn">Naruto</button>
          <button id="themeWarlordBtn" class="theme-btn">Warlord</button>
          <button id="themeResetBtn" class="theme-btn" title="Reset to default">Reset</button>
        </div>

        <!-- Notification Preferences -->
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:16px;">
          <span style="color:var(--text-secondary);font-size:13px;">Notifications:</span>
          <button id="openNotifPrefsBtn" class="gold-btn" style="font-size:12px;padding:8px 12px;">ğŸ”” Manage</button>
        </div>

        <!-- Logout -->
        <div style="border-top:1px solid rgba(212,175,55,0.2);padding-top:16px;margin-top:16px;">
          <button id="logoutBtn" class="gold-btn" style="width:100%;background:#ef4444;border:none;color:white;font-weight:600;">ğŸšª Logout</button>
        </div>
        <form id="settingsForm" class="settings-form">
          
          <!-- Avatar Section -->
          <div class="settings-section">
            <h3>Profile Picture</h3>
            <div class="avatar-upload">
              <img id="settingsAvatarPreview" class="avatar-preview" src="" alt="Profile">
               <div id="avatarUploadProgress" class="progress hidden" style="margin-top:8px;">
                 <div class="progress-bar" style="width:0%;height:8px;background:var(--gold);border-radius:4px;"></div>
               </div>
              <div class="upload-controls">
                <input id="avatarInput" type="file" accept="image/*" style="display:none;">
                <button type="button" id="uploadAvatarBtn" class="gold-btn">ğŸ“· Change Avatar</button>
                <p class="hint">JPG, PNG, GIF (Max 5MB)</p>
              </div>
            </div>
          </div>

          <!-- Personal Info Section -->
          <div class="settings-section">
            <h3>Personal Information</h3>
            
            <div class="form-group">
              <label>Username</label>
              <input id="settingsUsername" type="text" placeholder="Username" maxlength="20">
              <p class="hint">3-20 characters, letters, numbers, underscore</p>
            </div>

            <div class="form-group">
              <label>Email</label>
              <input id="settingsEmail" type="email" placeholder="Email">
              <p class="hint">Used for account recovery</p>
            </div>

            <div class="form-group">
              <label>Phone</label>
              <input id="settingsPhone" type="tel" placeholder="+1-555-0000">
              <p class="hint">Optional, for friend discovery</p>
            </div>
            
            <div class="form-group">
              <label>Two-Factor Authentication</label>
              <div style="display:flex;gap:8px;align-items:center;">
                <button id="enable2faBtn" type="button" class="gold-btn">Enable 2FA</button>
                <button id="disable2faBtn" type="button" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);">Disable 2FA</button>
              </div>
              <p class="hint">Protect your account with an authenticator app.</p>
            </div>
          </div>

          <!-- Bio Section -->
          <div class="settings-section">
            <h3>Bio</h3>
            <div class="form-group">
              <textarea id="settingsBio" placeholder="Tell us about yourself..." maxlength="200"></textarea>
              <p class="hint" id="bioCharCount">0/200 characters</p>
            </div>
          </div>

          <!-- Save Button -->
          <div class="settings-section">
            <button type="submit" class="gold-btn save-btn">ğŸ’¾ Save Changes</button>
            <p id="settingsStatus" class="status-message hidden"></p>
          </div>
        </form>
      </div>
    </div>

    <!-- 2FA Modal -->
    <div id="twoFaModal" class="modal hidden">
      <div class="modal-content" style="max-width:420px;">
        <h2>Two-Factor Authentication</h2>
        <div id="twoFaSetupArea" style="display:none;text-align:center;">
          <p>Scan this QR with your authenticator app</p>
          <img id="twoFaQr" src="" alt="QR" style="max-width:220px;border-radius:8px;border:2px solid rgba(212,175,55,0.1);">
          <p class="hint">Or enter secret: <span id="twoFaSecret"></span></p>
          <input id="twoFaSetupCode" placeholder="Enter code from app" />
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="confirm2faBtn" class="gold-btn">Enable 2FA</button>
            <button id="cancel2faBtn" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);">Cancel</button>
          </div>
          <div id="twoFaSetupStatus" class="hint"></div>
        </div>

        <div id="twoFaLoginArea" style="display:none;text-align:center;">
          <p>Enter your authenticator code to continue</p>
          <input id="twoFaLoginCode" placeholder="6-digit code" />
          <div style="display:flex;gap:8px;margin-top:12px;">
            <button id="submit2faLoginBtn" class="gold-btn">Verify</button>
            <button id="cancel2faLoginBtn" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);">Cancel</button>
          </div>
          <div id="twoFaLoginStatus" class="hint"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Image editor modal for attachments -->
  <div id="imageEditorModal" class="modal hidden">
    <div class="modal-content" style="max-width:720px;">
      <h3>Edit Image</h3>
      <canvas id="imageEditorCanvas" style="width:100%;background:#111;border:1px solid rgba(255,255,255,0.03);display:block;"></canvas>
      <div style="display:flex;gap:8px;margin-top:8px;">
        <button id="editorRotateBtn" class="gold-btn">Rotate 90Â°</button>
        <button id="editorCropSquareBtn" class="gold-btn">Crop Square</button>
        <button id="editorSaveBtn" class="gold-btn">Save</button>
        <button id="editorCancelBtn" class="gold-btn" style="background:transparent;border:1px solid rgba(255,255,255,0.04);">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Music Picker Modal (minimal placeholder until Spotify integration) -->
  <div id="musicPickerModal" class="modal hidden">
    <div class="modal-content" style="max-width:520px;">
      <h2>ğŸµ Music Picker</h2>
      <p style="color:var(--muted);font-size:13px;margin-bottom:12px;">Select a track to attach to your story. This is a lightweight placeholder â€” connect Spotify in settings for live search.</p>
      <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center;">
        <input id="musicSearchInput" type="search" placeholder="Search Spotify..." style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--muted);">
        <button id="musicSearchBtn" class="gold-btn">Search</button>
        <button id="spotifyConnectBtn" class="gold-btn" style="margin-left:6px;padding:8px 10px;">Connect Spotify</button>
      </div>
      <div id="musicList" style="display:flex;flex-direction:column;gap:8px;max-height:320px;overflow:auto;padding-right:6px;">
        <div class="music-item" data-id="sample_1" data-name="Breezy Loop" data-artist="Studio" data-preview="">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <strong>Breezy Loop</strong>
              <div style="font-size:13px;color:var(--muted);">Studio</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <button class="preview-music-btn gold-btn" type="button" data-preview="">â–¶ï¸</button>
              <button class="select-music-btn gold-btn" type="button">Select</button>
            </div>
          </div>
        </div>
        <div class="music-item" data-id="sample_2" data-name="Sunny Days" data-artist="Composer" data-preview="">
          <div style="display:flex;justify-content:space-between;align-items:center;">
            <div>
              <strong>Sunny Days</strong>
              <div style="font-size:13px;color:var(--muted);">Composer</div>
            </div>
            <div style="display:flex;gap:8px;align-items:center;">
              <button class="preview-music-btn gold-btn" type="button" data-preview="">â–¶ï¸</button>
              <button class="select-music-btn gold-btn" type="button">Select</button>
            </div>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end;">
        <button id="closeMusicPicker" class="gold-btn">Done</button>
      </div>
    </div>
  </div>

  <!-- Onboarding Modal -->
  <div id="onboardingModal" class="modal hidden">
    <div class="modal-content" style="max-width:520px;">
      <h2>Welcome to Wimpex</h2>
      <div id="onboardingStep1" class="onboard-step">
        <p>Step 1: Add a profile picture and a short bio so people know who you are.</p>
        <button id="onboardingNext1" class="gold-btn">Next</button>
      </div>
      <div id="onboardingStep2" class="onboard-step hidden">
        <p>Step 2: Find people you know â€” check recommendations and add friends.</p>
        <button id="onboardingNext2" class="gold-btn">Next</button>
      </div>
      <div id="onboardingStep3" class="onboard-step hidden">
        <p>Step 3: Enable notifications so you never miss a snap.</p>
        <button id="onboardingFinish" class="gold-btn">Finish</button>
        <button id="onboardingSkip" class="gold-btn" style="background:transparent;border:2px solid var(--gold);color:var(--gold);margin-left:8px;">Skip</button>
      </div>
      <div id="onboardingStatus" class="hint"></div>
    </div>
  </div>

  <!-- Story Viewer Modal -->
  <div id="storyViewerModal" class="modal hidden">
    <div class="story-viewer">
      <button id="closeStoryViewer" class="close-btn">âœ•</button>
      <div class="story-content">
        <img id="storyImage" src="" alt="" style="display:none;">
        <video id="storyVideo" style="display:none;" autoplay></video>
        <audio id="storyAudio" style="display:none;width:100%;margin-top:8px;" controls></audio>
        <div class="story-progress-bar"></div>
      </div>
      <div class="story-info">
        <strong id="storyUsername"></strong>
        <div id="storyCaption" style="margin-top:6px;color:var(--text-primary);"></div>
        <div id="storyMusicInfo" style="font-size:13px;color:var(--muted);"></div>
        <span id="storyTimestamp"></span>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="modal hidden">
    <div class="modal-content" style="max-width:500px;">
      <h2>Edit Profile</h2>
      <form id="editProfileForm">
        <!-- Avatar Upload -->
        <div style="margin-bottom:20px;text-align:center;">
          <img id="editAvatarPreview" src="" alt="Avatar" style="width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:10px;cursor:pointer;border:2px solid gold;">
          <input id="avatarFileInput" type="file" accept="image/*" style="display:none;">
          <p style="font-size:12px;color:#666;">Click avatar to change picture</p>
        </div>

        <!-- Username -->
        <input id="editUsername" type="text" placeholder="Username (2-30 chars)" maxlength="30" style="margin-bottom:10px;">

        <!-- Bio -->
        <textarea id="editBio" placeholder="Bio (max 160 chars)" maxlength="160" style="margin-bottom:10px;height:80px;resize:none;"></textarea>

        <!-- Location -->
        <input id="editLocation" type="text" placeholder="Location" maxlength="50" style="margin-bottom:10px;">

        <!-- Website -->
        <input id="editWebsite" type="url" placeholder="Website (optional)" maxlength="200" style="margin-bottom:10px;">

        <!-- Private Account Toggle -->
        <label style="display:flex;align-items:center;gap:8px;margin-bottom:15px;">
          <input id="editPrivateAccount" type="checkbox">
          <span>Private Account (followers must be approved)</span>
        </label>

        <button type="submit" class="gold-btn" style="width:100%;">Save Profile</button>
      </form>
      <button class="close-modal-btn" style="margin-top:10px;">Cancel</button>
    </div>
  </div>

  <!-- Friends Modal -->
  <div id="friendsModal" class="modal hidden">
    <div class="modal-content">
      <h2>ğŸ‘¥ Add Friends</h2>
      <form id="addFriendForm">
        <input id="friendInput" type="text" placeholder="Username or Phone Number">
        <button type="submit" class="gold-btn">Add Friend</button>
      </form>
      <div id="friendsList" class="friends-list"></div>
      <button class="close-modal-btn">Close</button>
    </div>
  </div>

  <!-- Privacy & Compliance Modals -->
  <div id="privacyModal" class="modal hidden">
    <div class="modal-content">
      <h2>ğŸ”’ Privacy Controls</h2>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <button id="blockUserBtn" class="gold-btn">ğŸš« Block Users</button>
        <button id="muteUserBtn" class="gold-btn">ğŸ”‡ Mute Users</button>
        <button id="reportUserBtn" class="gold-btn">âš ï¸ Report</button>
        <button id="exportDataBtn" class="gold-btn">ğŸ“¥ Export My Data (GDPR)</button>
        <button id="deleteAccountBtn" class="gold-btn" style="background:#c00;border:none;color:#fff;">ğŸ—‘ï¸ Delete My Account</button>
        <button class="close-modal-btn">Close</button>
      </div>
    </div>
  </div>

  <div id="notificationsPrefsModal" class="modal hidden">
    <div class="modal-content" style="max-width:480px;">
      <h2>ğŸ”” Notification Preferences</h2>
      <div style="display:flex;flex-direction:column;gap:12px;">
        <label style="display:flex;align-items:center;gap:8px;">
          <input id="dndToggle" type="checkbox"> Do Not Disturb (all notifications muted)
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input id="batchingToggle" type="checkbox"> Batch notifications (send hourly digest)
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input id="snapNotifToggle" type="checkbox" checked> Snaps
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input id="msgNotifToggle" type="checkbox" checked> Messages
        </label>
        <label style="display:flex;align-items:center;gap:8px;">
          <input id="friendNotifToggle" type="checkbox" checked> Friend requests
        </label>
        <button id="savePrefsBtn" class="gold-btn">Save Preferences</button>
        <button class="close-modal-btn">Close</button>
      </div>
    </div>
  </div>

  <div id="complianceModal" class="modal hidden">
    <div class="modal-content" style="max-width:600px;max-height:80vh;overflow-y:auto;">
      <h2>ğŸ“‹ Legal & Compliance</h2>
      <div style="display:flex;gap:8px;margin-bottom:12px;">
        <button id="privacyPolicyBtn" class="gold-btn">Privacy Policy</button>
        <button id="termsBtn" class="gold-btn">Terms of Service</button>
      </div>
      <div id="complianceContent" style="border:1px solid rgba(212,175,55,0.2);padding:12px;border-radius:6px;font-size:13px;line-height:1.6;white-space:pre-wrap;"></div>
      <button class="close-modal-btn">Close</button>
    </div>
  </div>

  <!-- Group Creation Modal -->
  <div id="groupCreationModal" class="modal hidden">
    <div class="modal-content" style="max-width:500px;">
      <h2>ğŸ‘¥ Create Group Chat</h2>
      <form id="groupCreationForm">
        <input id="groupName" type="text" placeholder="Group name" maxlength="50" required style="width:100%;padding:12px;border:2px solid rgba(212,175,55,0.2);border-radius:8px;background:rgba(212,175,55,0.05);color:var(--text-primary);margin-bottom:12px;">
        <label style="display:block;margin-bottom:12px;color:var(--text-secondary);font-size:14px;">Select members to add (optional):</label>
        <div id="groupMembersList" style="max-height:250px;overflow-y:auto;margin-bottom:12px;"></div>
        <button type="submit" class="gold-btn" style="width:100%;">Create Group</button>
      </form>
      <button class="close-modal-btn">Cancel</button>
    </div>
  </div>

  <!-- Friend Requests Modal -->
  <div id="friendRequestsModal" class="modal hidden">
    <div class="modal-content" style="max-width:500px;">
      <h2>ğŸ‘¥ Friend Requests</h2>
      <div id="pendingRequestsModalList" style="max-height:400px;overflow-y:auto;"></div>
      <div id="noPendingRequests" style="text-align:center;color:var(--text-secondary);padding:20px;">No pending friend requests</div>
      <button class="close-modal-btn" style="margin-top:16px;">Close</button>
    </div>
  </div>

  <script src="app.js"></script>
  <script src="chat_component.js"></script>
</body>
</html>
